<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nadine's Grand Final HD ‚öΩüèÜ</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #fbc531; --neon: #2ecc71; --grass-1: #1b5e20; --grass-2: #24702a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: #000; font-family: 'Quicksand', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        .stadium-frame {
            width: 100%; max-width: 460px; height: 100vh; max-height: 800px;
            background: #2c3e50; border: 6px solid #1a1a1a; position: relative;
            box-shadow: 0 0 100px rgba(46, 204, 113, 0.2); overflow: hidden;
        }

        canvas { width: 100%; height: 100%; z-index: 10; position: relative; cursor: crosshair; }

        /* UI Styling */
        .overlay {
            position: absolute; inset: 0; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 30px;
            z-index: 100; background: rgba(0,0,0,0.85); backdrop-filter: blur(12px); text-align: center; color: white;
        }

        .profile-glow {
            width: 140px; height: 140px; border: 4px solid var(--gold);
            border-radius: 50%; overflow: hidden; margin-bottom: 20px;
            box-shadow: 0 0 30px var(--gold); animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .profile-glow img { width: 100%; height: 100%; object-fit: cover; }

        .btn-pro {
            background: var(--gold); border: none; color: #000; padding: 20px 45px;
            font-family: 'Press Start 2P'; font-size: 10px; border-radius: 50px;
            box-shadow: 0 8px 0 #b88e09; cursor: pointer; transition: 0.2s;
        }
        .btn-pro:active { transform: translateY(4px); box-shadow: none; }

        .hud-hd {
            position: absolute; top: 20px; width: 100%; padding: 0 25px;
            display: flex; justify-content: space-between; z-index: 50;
            font-family: 'Press Start 2P'; font-size: 10px; color: #fff; pointer-events: none;
            text-shadow: 2px 2px 4px #000;
        }

        .power-container {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            width: 220px; height: 16px; background: rgba(0,0,0,0.7); border: 2px solid #fff;
            border-radius: 20px; display: none; overflow: hidden; z-index: 60;
        }
        #p-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #2ecc71, #f1c40f, #e74c3c); transition: width 0.1s linear; }

        #goal-alert {
            position: absolute; top: 35%; width: 100%; text-align: center;
            font-family: 'Press Start 2P'; font-size: 40px; color: #fff;
            text-shadow: 0 0 25px var(--gold); display: none; z-index: 90; pointer-events: none;
            animation: zoomIn 0.5s ease;
        }
        @keyframes zoomIn { from { transform: scale(0); } to { transform: scale(1.2); } }

        #letter-box { background: #fff; color: #111; padding: 25px; border-radius: 20px; font-size: 14px; line-height: 1.8; text-align: left; max-height: 300px; overflow-y: auto; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="stadium-frame" id="shaker">
    <div class="hud-hd">
        <span>STAGE: <span id="stg">1</span></span>
        <span>GOAL: <span id="score">0/3</span></span>
    </div>

    <div id="goal-alert">GOAL SAYANG!</div>
    <div class="power-container" id="p-bar"><div id="p-fill"></div></div>
    <canvas id="gameCanvas"></canvas>

    <div id="ui-start" class="overlay">
        <div class="profile-glow">
            <img src="https://img.sanishtech.com/u/59406307f2b2bcfeec62742455b992a7.png" alt="Nadine">
        </div>
        <h2 style="font-family:'Press Start 2P'; font-size: 14px; color: var(--gold); margin-bottom: 5px;">SWEET PENALTY</h2>
        <p style="font-size: 12px; color: #ccc; margin-bottom: 25px;">Karena hari ini aku main bola, jadinya ak bikin game bola buat kamu sayanggü´∂üèª</p>
        <button class="btn-pro" onclick="initGame()">MAINKAN YUKK ‚öΩ</button>
    </div>

    <div id="ui-win" class="overlay hidden">
        <h1 style="font-family:'Press Start 2P'; font-size: 16px; color: var(--gold);">THE WINNER OF MY HEART üèÜ</h1>
        <div id="letter-box"></div>
        <button class="btn-pro" onclick="location.reload()" style="margin-top:20px">REMATCH</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const shaker = document.getElementById('shaker');
    let audio, active = false, stage = 1, goals = 0, width, height;
    
    let ball = { x: 0, y: 0, r: 20, vx: 0, vy: 0, kicked: false, power: 0, s: 1, shadowY: 0 };
    let goalie = { x: 0, y: 160, w: 75, h: 50, tx: 0, speed: 2, diving: false };
    let particles = [];
    let isHolding = false;
    let crowd = [];

    function playSound(f, t, d, v) {
        if(!audio) return;
        let o = audio.createOscillator(), g = audio.createGain();
        o.type = t; o.frequency.setValueAtTime(f, audio.currentTime);
        g.gain.setValueAtTime(v, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + d);
        o.connect(g); g.connect(audio.destination);
        o.start(); o.stop(audio.currentTime + d);
    }

function initGame() {
    audio = new (window.AudioContext || window.webkitAudioContext)();
    document.getElementById('ui-start').classList.add('hidden');
    resize();
    resetBall();
    active = true;
    
    playMusic(); // <-- LAGU DIMULAI DI SINI!
    
    loop();
}


    function resize() {
        width = canvas.width = canvas.offsetWidth;
        height = canvas.height = canvas.offsetHeight;
    }

    function resetBall() {
        ball.x = width/2; ball.y = height - 120;
        ball.vx = 0; ball.vy = 0; ball.kicked = false; ball.power = 0; ball.s = 1;
        isHolding = false; document.getElementById('p-bar').style.display = 'none';
        goalie.diving = false;
    }

    const startHold = () => { if(active && !ball.kicked) { isHolding = true; document.getElementById('p-bar').style.display = 'block'; }};
    const endHold = (e) => {
        if(!isHolding) return;
        let r = canvas.getBoundingClientRect();
        let cx = (e.changedTouches ? e.changedTouches[0].clientX : e.clientX) - r.left;
        ball.vx = (cx - ball.x) * (0.05 + ball.power*0.001);
        ball.vy = -14 - (ball.power * 0.12);
        ball.kicked = true; isHolding = false;
        playSound(100, 'sine', 0.4, 0.5); // Thump kick
    };

    canvas.addEventListener('mousedown', startHold);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startHold(); });
    window.addEventListener('mouseup', endHold);
    window.addEventListener('touchend', endHold);

    function createFirework(x, y) {
        for(let i=0; i<30; i++) {
            particles.push({
                x: x, y: y,
                vx: (Math.random()-0.5)*15, vy: (Math.random()-0.5)*15,
                c: `hsl(${Math.random()*360}, 100%, 50%)`, life: 1, r: Math.random()*4+2
            });
        }
    }

    function drawField() {
        // High Definition Grass Stripes
        for(let i=0; i<height; i+=50) {
            ctx.fillStyle = (i/50)%2 === 0 ? "#1b5e20" : "#24702a";
            ctx.fillRect(0, i, width, 50);
        }
        // Stadium Crowd (HD)
        crowd.forEach(p => {
            let jump = active ? Math.sin(Date.now()*0.01 + p.off)*4 : 0;
            ctx.fillStyle = p.c;
            ctx.fillRect(p.x, p.y + jump, 8, 12);
        });
        // Goal Area & Glow
        ctx.shadowBlur = 20; ctx.shadowColor = "white";
        ctx.strokeStyle = "rgba(255,255,255,0.8)"; ctx.lineWidth = 6;
        ctx.strokeRect(width/2 - 140, 60, 280, 100);
        ctx.shadowBlur = 0;
    }
      
    function loop() {
        if(!active) return;
        ctx.clearRect(0,0,width,height);
        drawField();

        if(isHolding) {
            ball.power = Math.min(ball.power + 2.5, 100);
            document.getElementById('p-fill').style.width = ball.power + '%';
        }

        // Complex Goalie AI
        goalie.speed = 0.8 + (stage * 0.2);
        if(!ball.kicked) {
            if(Math.abs(goalie.x - goalie.tx) < 10) goalie.tx = Math.random()*(width-120)+20;
            goalie.x += (goalie.tx > goalie.x ? 1 : -1) * goalie.speed;
        } else {
            // Dive Reaction
            let targetX = ball.x - goalie.w/2;
            goalie.x += (targetX - goalie.x) * 0.03 * stage;
            goalie.diving = true;
        }
        ctx.font = "60px Arial";
        ctx.fillText(goalie.diving ? "üëê" : "üß§", goalie.x, goalie.y);

        // Particle System (Fireworks)
        particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.vy += 0.25; p.life -= 0.02;
            ctx.globalAlpha = p.life; ctx.fillStyle = p.c;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            if(p.life <= 0) particles.splice(i, 1);
        });
        ctx.globalAlpha = 1;

        // Ball Mechanics
        if(ball.kicked) {
            ball.x += ball.vx; ball.y += ball.vy; ball.vy += 0.35;
            ball.s = Math.max(0.6, 1 - (height - ball.y)*0.001);
            
            // Dynamic Shadow
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.beginPath(); ctx.ellipse(ball.x, height-110, 15*ball.s, 8*ball.s, 0, 0, Math.PI*2); ctx.fill();

            // Collision Check
            let dist = Math.hypot(ball.x - (goalie.x + goalie.w/2), ball.y - goalie.y);
            if(dist < 45) {
                playSound(200, 'square', 0.2, 0.3);
                shaker.style.animation = 'none'; shaker.offsetHeight; shaker.style.animation = 'shake 0.2s';
                resetBall();
            }

            // Goal Scoring
            if(ball.y < 160) {
                if(ball.x > width/2-140 && ball.x < width/2+140) {
                    goals++; 
                    document.getElementById('score').innerText = goals+"/3";
                    document.getElementById('goal-alert').style.display = 'block';
                    setTimeout(() => document.getElementById('goal-alert').style.display = 'none', 1000);
                    playSound(800, 'sine', 0.1, 0.2); setTimeout(() => playSound(1200, 'sine', 1, 0.4), 100);
                    createFirework(ball.x, ball.y);
                    if(goals >= 3) {
                        if(stage < 3) { stage++; goals = 0; document.getElementById('stg').innerText = stage; document.getElementById('score').innerText = "0/3"; }
                        else { finish(); }
                    }
                }
                resetBall();
            }
            if(ball.y > height + 50 || ball.x < 0 || ball.x > width) resetBall();
        } else {
            // Idle Shadow
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.beginPath(); ctx.ellipse(ball.x, ball.y+15, 18, 10, 0, 0, Math.PI*2); ctx.fill();
        }

        // Render Ball
        ctx.save();
        ctx.translate(ball.x, ball.y);
        ctx.scale(ball.s, ball.s);
        ctx.shadowBlur = 10; ctx.shadowColor = "rgba(0,0,0,0.5)";
        ctx.font = "48px Arial"; ctx.fillText("‚öΩ", -23, 20);
        ctx.restore();

        requestAnimationFrame(loop);
    }

// --- BAGIAN PERBAIKAN ---

let musicInterval; // Definisi variabel global

function playMusic() {
    if (!audio || !active) return;
    
    const melody = [261.63, 293.66, 329.63, 349.23, 392.00, 329.63, 261.63, 392.00]; 
    let step = 0;

    musicInterval = setInterval(() => {
        if (!active) {
            clearInterval(musicInterval);
            return;
        }
        let note = melody[step % melody.length];
        let osc = audio.createOscillator();
        let gain = audio.createGain();
        
        osc.type = 'triangle'; 
        osc.frequency.setValueAtTime(note, audio.currentTime);
        gain.gain.setValueAtTime(0.05, audio.currentTime); 
        gain.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + 0.5);
        
        osc.connect(gain);
        gain.connect(audio.destination);
        
        osc.start();
        osc.stop(audio.currentTime + 0.5);
        step++;
    }, 400);
}

function finish() {
    active = false;
    clearInterval(musicInterval); // Matikan musik utama

    if (audio) {
        let now = audio.currentTime;

        // 1. TEROMPET KEMENANGAN
        const fanfare = [523, 659, 783, 1046, 1318]; 
        fanfare.forEach((f, i) => {
            let o = audio.createOscillator();
            let g = audio.createGain();
            o.type = 'sawtooth';
            o.frequency.setValueAtTime(f, now + (i * 0.1));
            g.gain.setValueAtTime(0.2, now + (i * 0.1));
            g.gain.exponentialRampToValueAtTime(0.0001, now + (i * 0.1) + 1.5);
            o.connect(g); g.connect(audio.destination);
            o.start(now + (i * 0.1)); o.stop(now + (i * 0.1) + 1.5);
        });

        // 2. SUARA KEMBANG API
        for (let j = 0; j < 5; j++) {
            let delay = j * 0.3;
            let o = audio.createOscillator();
            let g = audio.createGain();
            o.type = 'square'; 
            o.frequency.setValueAtTime(100 + Math.random() * 500, now + 0.5 + delay);
            g.gain.setValueAtTime(0.1, now + 0.5 + delay);
            g.gain.exponentialRampToValueAtTime(0.0001, now + 1.0 + delay);
            o.connect(g); g.connect(audio.destination);
            o.start(now + 0.5 + delay); o.stop(now + 1.0 + delay);
        }
    }

    // Menampilkan UI Menang
    document.getElementById('ui-win').classList.remove('hidden');
    const box = document.getElementById('letter-box');
    const txt = "HAIII SAYANGGG SUDAA BERHASIL MENCETAK BANYAK GOOLL YAAAA????\n\nwahh kerennn atuhhh, ngalahin gol fathan hari inii wkwkwkwkw. nahh game sweet gol inii adaa karenaa hari ini fathan main bolaa dan tadii ada cerita bahwa kamu di tanyain kenapa ga main bolaa, jadii fathan buatin game ini biar kamu bisaa main bolaaaa.. walaupun masih jelekk tapii semogaa kamu sukaa yaaa sayangg \n\nnahh fathan mau berterimakasih jugaa yaa harii iniii, sehariann nemenin fathann kamuu.. dari bangun boboo sampe kamu bobo lagiii, timakasii yaa udaa berjalan menuju kelas sama fathannn, teruss mau ngobrol sama fathann banyak banyakk, laluuu membelikan fathann eskimm ihhh, sudaa terlalu banyak kamu membelikam ak eskimm wkwkwkkw, timakasii banyakk yaa sayangg.. tadii pas pulang jugaa kamu masih nemenin fathannnn.. waawww seruu sekali deh hari inii, dann alhamdulillahh akhirnyaa bisa sekelompok samaa kamuu lagiii, yaaa walaupun di persulitt tapi semogaa kitaa tetap bisa bersamaa yaa sayanggg.. aamiin dehhh\n\nnahh sepertinyaa kamu jugaa ketidurann nihhh, jadiii selamat beristirahatt yaa sayangkuu cintakuuu, kamu cape kann hari inii? alhamdulillah deh bisa istirahat lebih awall, goodnightt yaa sayangg.. besokk kitaa seru seruan lagii yaakk? okeeyy? bagussdeee wkwkwkwk.. paipaii papaii sayangku cintakuuu, mimpi yang indahh yaa syanggg. je t'aimeeee bieennn nadinee syakiraa prettyyyy üíô‚ú®ü•á";
    
    let i = 0;
    box.innerHTML = ""; 
    function type() { 
        if(i < txt.length) { 
            box.innerHTML += txt.charAt(i); 
            i++; 
            setTimeout(type, 40); 
            box.scrollTop = box.scrollHeight; 
        } 
    }
    type();
}
</script>

<style>
    @keyframes shake {
        0% { transform: translate(1px, 1px) rotate(0deg); }
        20% { transform: translate(-3px, 0px) rotate(-1deg); }
        40% { transform: translate(3px, 2px) rotate(1deg); }
        60% { transform: translate(-3px, 1px) rotate(0deg); }
        80% { transform: translate(3px, 1px) rotate(-1deg); }
        100% { transform: translate(1px, -2px) rotate(0deg); }
    }
</style>


</script>
<style>
    @keyframes shake {
        0% { transform: translate(1px, 1px) rotate(0deg); }
        20% { transform: translate(-3px, 0px) rotate(-1deg); }
        40% { transform: translate(3px, 2px) rotate(1deg); }
        60% { transform: translate(-3px, 1px) rotate(0deg); }
        80% { transform: translate(3px, 1px) rotate(-1deg); }
        100% { transform: translate(1px, -2px) rotate(0deg); }
    }
</style>
</body>
</html>
